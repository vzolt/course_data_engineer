Практика HDFS

1. Когда мы перетащили файлы с произведением Льва Толстого – мы перетащили их в файловую систему виртуальной машины, но не в HDFS, соответственно, в первую очередь нам нужно перенести их в папку нашего пользователя именно на HDFS.

hdfs dfs -copyFromLocal vim1.txt /user/cloudera/

hdfs dfs -copyFromLocal vim2.txt /user/cloudera/

hdfs dfs -copyFromLocal vim3.txt /user/cloudera/

hdfs dfs -copyFromLocal vim4.txt /user/cloudera/

2. После того, как файлы окажутся на HDFS попробуйте выполнить команду, которая выводит содержимое папки. Особенно обратите внимание на права доступа к вашим файлам.

-rw-r--r-- 3 root cloudera 1275160 2022-12-25 19:54 /user/cloudera/vim1.txt
-rw-r--r-- 3 root cloudera 1366235 2022-12-25 19:55 /user/cloudera/vim2.txt
-rw-r--r-- 3 root cloudera 1476330 2022-12-25 19:55 /user/cloudera/vim3.txt
-rw-r--r-- 3 root cloudera 1246282 2022-12-25 19:56 /user/cloudera/vim4.txt

3. Далее сожмите все 4 тома в 1 файл.

hdfs dfs -cat /user/cloudera/* | hdfs dfs -appendToFile - /user/cloudera/voyna-i-mir.txt

4. Теперь давайте изменим права доступа к нашему файлу. Чтобы с нашим файлом могли взаимодействовать коллеги, установите режим доступа, который дает полный доступ для владельца файла, а для сторонних пользователей возможность читать и выполнять.

hdfs dfs -chmod 755 "/user/cloudera/vim*.txt"

5. Попробуйте заново использовать команду для вывода содержимого папки и обратите внимание как изменились права доступа к файлу.

hdfs dfs -ls /user/cloudera/

-rwxr-xr-x 3 root cloudera 1275160 2022-12-25 19:59 /user/cloudera/vim1.txt
-rwxr-xr-x 3 root cloudera 1366235 2022-12-25 20:00 /user/cloudera/vim2.txt
-rwxr-xr-x 3 root cloudera 1476330 2022-12-25 20:00 /user/cloudera/vim3.txt
-rwxr-xr-x 3 root cloudera 1246282 2022-12-25 20:01 /user/cloudera/vim4.txt
-rw-r--r-- 3 root cloudera 5364007 2022-12-25 20:09 /user/cloudera/voyna-i-mir.txt

6. Теперь попробуем вывести на экран информацию о том, сколько места на диске занимает наш файл. Желательно, чтобы размер файла был удобночитаемым.

hdfs dfs -du -h /user/cloudera/

719.3 K 719.3 K /user/cloudera/vim1.txt

752.3 K 752.3 K /user/cloudera/vim2.txt

823.4 K 823.4 K /user/cloudera/vim3.txt

681.6 K 681.6 K /user/cloudera/vim4.txt

2.9 M 2.9 M /user/cloudera/voyna-i-mir.txt

7. На экране вы можете заметить 2 числа. Первое число – это фактический размер файла, а второе – это занимаемое файлом место на диске с учетом репликации. По умолчанию в данной версии HDFS эти числа будут одинаковы – это означает, что никакой репликации нет – нас это не очень устраивает, мы хотели бы, чтобы у наших файлов существовали резервные копии, поэтому напишите команду, которая изменит фактор репликации на 2.

hdfs dfs -setrep 2 /user/cloudera/*

8. Повторите команду, которая выводит информацию о том, какое место на диске занимает файл и убедитесь, что изменения произошли.

hdfs dfs -du -h /user/cloudera/

719.3 K 1.4 M /vim1.txt

752.3 K 1.5 M /vim2.txt

823.4 K 1.6 M /vim3.txt

681.6 K 1.3 M /vim4.txt

2.9 M 5.8 M /voyna-i-mir.txt

9. Напишите команду, которая подсчитывает количество строк в вашем файле.

hdfs dfs -cat /voyna-i-mir.txt | wc -l

10272
